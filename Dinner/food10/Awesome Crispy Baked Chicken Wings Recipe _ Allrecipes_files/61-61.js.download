(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{412:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a.n(n),r=a(1),s=a.n(r),o=a(791),d=a(5),c=a.n(d),h=a(4),l=a(830),u=a(71);function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m=null,p=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$context=t,this.$document=s()(document),this.$body=s()(document.body),this.$frameWrapper=s()(".embeddedAuth__frame",this.$context),this.$frame=null,this.messageType=this.$context.closest(".embedded-auth-modal.modal").length?"banner":"block",this.bindEmbedEvents(),this.alertText={error:"There was an error logging you in. Please try again later.",signup:"Account created. Welcome!",signin:"Signed in. Welcome Back!"},this.embedType=t.attr("data-embed-type"),this.frameLinks={signup:"/account/signup",signin:"/account/signin","quick-signup":"/account/quick-signup"},this.embedType){var a=new URLSearchParams(window.location.search);this.regsource=a.get("regsource")||a.get("regSource")||t.attr("data-regsource"),this.frameClass=t.attr("data-frame-class"),this.optionalSignup=t.attr("data-optional-signup");var n=i.a.get(this,"frameLinks[".concat(this.embedType,"]")),r=this.regsource?"&regsource=".concat(this.regsource):"",o=this.frameClass?"&frameclass=".concat(this.frameClass):"",d=this.optionalSignup?"&optionalsignup=".concat(this.optionalSignup):"",c="".concat(n,"?modal=true&type=").concat(this.embedType).concat(r).concat(o).concat(d);if(this.$body.hasClass("template-node-entry-page")){var h=this.$body.attr("data-content-graph-id"),u=Object(l.a)(h).id,g=i.a.replace(u,/\D/g,"");c+="&originatingSourceId=".concat(g,"&originatingSource=sweepstakes")}this.changePage(c)}var m=this;this.$document.on("quick-reg:request-complete",(function(e){m.$frameWrapper.find("iframe").contents().get(0)===e.detail.context&&m.resizeFrame()})),this.$context.addClass("initialized")}var t,a,n;return t=e,(a=[{key:"showBannerMessage",value:function(e){var t=i.a.get(e,"detail.type")||"signin";if("error"===t&&"User closed the popup window"===i.a.get(e,"detail.response.original"))return!1;var a=s()(".auth-modal-banner");return a.length&&(a.addClass("error"===t?"type-error":"type-success-signed-in"),a.removeClass("hidden"),a.find(".alert-text").text(this.alertText[t])),!0}},{key:"showSuccessBlock",value:function(e){var t=i.a.get(e,"detail.type")||"signin";if("error"===t||"User closed the popup window"===i.a.get(e,"detail.response.original"))return!1;var a=s()(".embeddedAuth__success",this.$context);return!!a.length&&(s()(".embeddedAuth__successHeading",a).text("signup"===t?"Sign Up":"Sign In"),s()(".embeddedAuth__successBody",a).text(this.alertText[t]),a.removeClass("hidden").parent().addClass("success"),!0)}},{key:"handleMessage",value:function(e){if(this.$frame&&this.$frame.length){var t=!1,a=s()(i.a.get(e,"detail.context.document"));a.length&&a.is(this.$frame.contents())&&(t="banner"===this.messageType?this.showBannerMessage(e):this.showSuccessBlock(e)),t&&(m.close(),this.$frameWrapper&&this.$frameWrapper.length&&(this.$frame.remove(),this.$frameWrapper.removeAttr("style")))}}},{key:"resizeFrame",value:function(){var e=this.$frame.contents();if(e.length){var t=s()("html",e),a={width:t.outerWidth(!1)||"100%",height:t.outerHeight(!1)||"100%"};this.$frameWrapper.width(a.width),this.$frameWrapper.height(a.height)}}},{key:"changePage",value:function(e){var t=this;if(e){this.$frame=s()("iframe",this.$frameWrapper);var a=this.$frame.contents(),n=a.length?i.a.get(a.get(0),"location.href"):null;if(!this.$frame.length||n&&-1!==n.indexOf(e.split("?")[0])||(this.$frameWrapper.removeClass("loaded"),this.$frame.attr("src",e)),!this.$frame||!this.$frame.length){var r=-1===e.indexOf("account/signup")?"Sign In":"Sign Up";this.$frame=s()('<iframe class="embeddedAuth__iframe" title="'.concat(r,'" src="').concat(e,'"></iframe>')),this.$frameWrapper.length&&(this.$frame.unbind("load"),this.$frame.unbind("unload"),this.$frame.on("load",(function(){t.resizeFrame(),t.$frameWrapper.addClass("loaded")})),this.$frameWrapper.html(this.$frame))}}}},{key:"bindEmbedEvents",value:function(){var e=this;window.addEventListener("message",(function(t){var a=u.a.data(),n=i.a.get(t,"data.iFrameSize"),r={};n&&n.height>0&&e.$frameWrapper.length&&"sweepstakes-entry-page"!==a.contentType&&(r.category="engagement",r.label="sign up modal",window.analytics.track("impression",Object.assign({},a,r)))})),window.addEventListener("user-authenticated",(function(t){e.handleMessage(t)})),document.addEventListener("quick-reg:request-success",(function(t){e.handleMessage(t)}))}}])&&g(t.prototype,a),n&&g(t,n),e}();function f(){var e=s()(".embedded-auth").not(".initialized");e.length&&s.a.each(e,(function(e,t){var a=s()(t),n=new p(a);a.data("embeddedAuth",n)}))}t.default=function(){var e=s()(".embedded-auth-modal");f(),s()(document).on("initialize.embedded-auth",(function(){f()})),e.length&&e.not(".initialized").length&&function(){var e=s()(".embedded-auth-modal"),t=s()(".embedded-auth-modal-trigger a, .embedded-auth-modal-trigger button, a.embedded-auth-modal-trigger, button.embedded-auth-modal-trigger");t.length&&(m=new o.a(e,"embedded-auth-modal"),t.attr("data-tracking-do-not-follow",!0),c()(h.m).subscribe((function(a,n){if(!n.closest(t).length&&n.closest("a.embedded-auth-modal-trigger").length&&t.push(n.closest(".embedded-auth-modal-trigger")[0]),!n.closest(t).length||s()("body").hasClass("authenticated")||s()("body").hasClass("euUser")){var i=n.closest(".gated-link"),r=i.attr("href");i.length&&r&&window.open(r,"_blank")}else{a.preventDefault();var o=s()(".partial.modal.hamburger .close");document.body.classList.contains("modal-active")&&o&&o.click();var d=n.closest("a");if(d.length||(d=n.closest("button")),!d.length)return;var c=d.attr("data-login-url")||d.attr("href");c="".concat(c).concat(-1===c.indexOf("?")?"?":"&","modal=true");var h=s()(".embedded-auth",e);if(!h.length)return;h.data("embeddedAuth").changePage(c),m.open()}})),window.addEventListener("user-authenticated",(function(e){"error"===i.a.get(e,"detail.type")&&"User closed the popup window"===i.a.get(e,"detail.response.original")||m.close()})),e.addClass("initialized"))}()}}}]);
//# sourceMappingURL=61-61.js.map